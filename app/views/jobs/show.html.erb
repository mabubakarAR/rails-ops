<div class="container">
  <div class="row">
    <div class="col-lg-8">
      <!-- Job Header -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="d-flex align-items-start justify-content-between mb-3">
            <div class="d-flex align-items-center">
              <% if @job.company&.logo.present? %>
                <img src="<%= @job.company.logo %>" alt="<%= @job.company.name %>" class="rounded me-3" style="width: 80px; height: 80px; object-fit: cover;">
              <% else %>
                <div class="bg-primary text-white rounded d-flex align-items-center justify-content-center me-3" style="width: 80px; height: 80px;">
                  <i class="fas fa-building fa-2x"></i>
                </div>
              <% end %>
              <div>
                <h1 class="h3 fw-bold mb-1"><%= @job.title %></h1>
                <h5 class="text-muted mb-0"><%= @job.company&.name %></h5>
                <div class="d-flex align-items-center mt-2">
                  <i class="fas fa-map-marker-alt text-muted me-2"></i>
                  <span class="text-muted"><%= @job.location %></span>
                  <% if @job.remote %>
                    <span class="badge bg-info ms-2">Remote</span>
                  <% end %>
                </div>
              </div>
            </div>
            
            <!-- Job Status Badge -->
            <div>
              <span class="badge bg-<%= @job.active? ? 'success' : 'secondary' %> fs-6">
                <%= @job.status.humanize %>
              </span>
            </div>
          </div>

          <!-- Salary and Employment Type -->
          <div class="row mb-3">
            <div class="col-md-6">
              <% if @job.salary_min.present? || @job.salary_max.present? %>
                <div class="d-flex align-items-center">
                  <i class="fas fa-dollar-sign text-success me-2"></i>
                  <span class="fw-semibold">
                    <% if @job.salary_min.present? && @job.salary_max.present? %>
                      $<%= number_with_delimiter(@job.salary_min) %> - $<%= number_with_delimiter(@job.salary_max) %>
                    <% elsif @job.salary_min.present? %>
                      From $<%= number_with_delimiter(@job.salary_min) %>
                    <% elsif @job.salary_max.present? %>
                      Up to $<%= number_with_delimiter(@job.salary_max) %>
                    <% end %>
                  </span>
                </div>
              <% end %>
            </div>
            <div class="col-md-6">
              <div class="d-flex align-items-center">
                <i class="fas fa-clock text-primary me-2"></i>
                <span class="fw-semibold"><%= @job.employment_type.humanize %></span>
              </div>
            </div>
          </div>

          <!-- Posted Date -->
          <div class="text-muted">
            <i class="fas fa-calendar me-2"></i>
            Posted <%= time_ago_in_words(@job.created_at) %> ago
          </div>
        </div>
      </div>

      <!-- Job Description -->
      <div class="card mb-4">
        <div class="card-header">
          <h3 class="fw-bold mb-0">Job Description</h3>
        </div>
        <div class="card-body">
          <div class="job-description">
            <%= simple_format(@job.description) %>
          </div>
        </div>
      </div>

      <!-- Requirements -->
      <% if @job.requirements.present? %>
        <div class="card mb-4">
          <div class="card-header">
            <h3 class="fw-bold mb-0">Requirements</h3>
          </div>
          <div class="card-body">
            <div class="requirements">
              <%= simple_format(@job.requirements) %>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Benefits -->
      <% if @job.benefits.present? %>
        <div class="card mb-4">
          <div class="card-header">
            <h3 class="fw-bold mb-0">Benefits</h3>
          </div>
          <div class="card-body">
            <div class="benefits">
              <%= simple_format(@job.benefits) %>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Company Information -->
      <div class="card mb-4">
        <div class="card-header">
          <h3 class="fw-bold mb-0">About <%= @job.company&.name %></h3>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-8">
              <% if @job.company&.description.present? %>
                <p class="mb-3"><%= @job.company.description %></p>
              <% end %>
              
              <div class="row">
                <% if @job.company&.headquarters.present? %>
                  <div class="col-md-6 mb-2">
                    <i class="fas fa-map-marker-alt text-primary me-2"></i>
                    <strong>Headquarters:</strong> <%= @job.company.headquarters %>
                  </div>
                <% end %>
                <% if @job.company&.industry.present? %>
                  <div class="col-md-6 mb-2">
                    <i class="fas fa-industry text-primary me-2"></i>
                    <strong>Industry:</strong> <%= @job.company.industry %>
                  </div>
                <% end %>
                <% if @job.company&.size.present? %>
                  <div class="col-md-6 mb-2">
                    <i class="fas fa-users text-primary me-2"></i>
                    <strong>Company Size:</strong> <%= @job.company.size.humanize %>
                  </div>
                <% end %>
                <% if @job.company&.founded_year.present? %>
                  <div class="col-md-6 mb-2">
                    <i class="fas fa-calendar text-primary me-2"></i>
                    <strong>Founded:</strong> <%= @job.company.founded_year %>
                  </div>
                <% end %>
              </div>
            </div>
            <div class="col-md-4 text-center">
              <% if @job.company&.logo.present? %>
                <img src="<%= @job.company.logo %>" alt="<%= @job.company.name %>" class="img-fluid rounded mb-3" style="max-width: 150px;">
              <% end %>
              <% if @job.company&.website.present? %>
                <a href="<%= @job.company.website %>" target="_blank" class="btn btn-outline-primary">
                  <i class="fas fa-external-link-alt me-2"></i>Visit Website
                </a>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
      <!-- Apply Button -->
      <div class="card mb-4">
        <div class="card-body text-center">
          <% if user_signed_in? %>
            <% if current_user.job_seeker? %>
              <% if current_user.job_seeker.present? %>
                <% if @job.can_apply?(current_user.job_seeker) %>
                  <%= link_to "Apply Now", new_job_application_path(@job), class: "btn btn-primary btn-lg w-100 mb-3" %>
                <% else %>
                  <button class="btn btn-secondary btn-lg w-100 mb-3" disabled>
                    <% if @job.job_applications.exists?(job_seeker: current_user.job_seeker) %>
                      Already Applied
                    <% elsif !@job.active? %>
                      Job Not Active
                    <% else %>
                      Cannot Apply
                    <% end %>
                  </button>
                <% end %>
              <% else %>
                <%= link_to "Create Profile to Apply", new_job_seeker_path, class: "btn btn-primary btn-lg w-100 mb-3" %>
              <% end %>
            <% elsif current_user.company? %>
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                This is your job posting
              </div>
              <%= link_to "Edit Job", edit_job_path(@job), class: "btn btn-outline-primary w-100 mb-2" %>
              <%= link_to "View Applications", job_applications_path, class: "btn btn-outline-secondary w-100" %>
            <% end %>
          <% else %>
            <%= link_to "Sign Up to Apply", new_user_registration_path(role: 'job_seeker'), class: "btn btn-primary btn-lg w-100 mb-3" %>
            <%= link_to "Login", new_user_session_path, class: "btn btn-outline-primary w-100" %>
          <% end %>
        </div>
      </div>

      <!-- Job Stats -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="fw-bold mb-0">Job Statistics</h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6">
              <h4 class="fw-bold text-primary"><%= @job.total_applications %></h4>
              <p class="text-muted mb-0">Applications</p>
            </div>
            <div class="col-6">
              <h4 class="fw-bold text-success"><%= @job.pending_applications %></h4>
              <p class="text-muted mb-0">Pending</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Share Job -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="fw-bold mb-0">Share This Job</h5>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <button class="btn btn-outline-primary" onclick="copyJobLink()">
              <i class="fas fa-copy me-2"></i>Copy Link
            </button>
            <a href="mailto:?subject=<%= @job.title %> at <%= @job.company&.name %>&body=Check out this job: <%= request.url %>" class="btn btn-outline-secondary">
              <i class="fas fa-envelope me-2"></i>Email Job
            </a>
          </div>
        </div>
      </div>

      <!-- Related Jobs -->
      <% if @job.company&.jobs&.where.not(id: @job.id)&.active&.any? %>
        <div class="card">
          <div class="card-header">
            <h5 class="fw-bold mb-0">More Jobs at <%= @job.company&.name %></h5>
          </div>
          <div class="card-body">
            <% @job.company.jobs.where.not(id: @job.id).active.limit(3).each do |related_job| %>
              <div class="mb-3">
                <%= link_to related_job.title, job_path(related_job), class: "text-decoration-none" %>
                <div class="small text-muted">
                  <%= related_job.location %>
                  <% if related_job.remote %>
                    <span class="badge bg-info ms-1">Remote</span>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
function copyJobLink() {
  navigator.clipboard.writeText(window.location.href).then(function() {
    // Show success message
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-check me-2"></i>Copied!';
    button.classList.remove('btn-outline-primary');
    button.classList.add('btn-success');
    
    setTimeout(function() {
      button.innerHTML = originalText;
      button.classList.remove('btn-success');
      button.classList.add('btn-outline-primary');
    }, 2000);
  });
}
</script>